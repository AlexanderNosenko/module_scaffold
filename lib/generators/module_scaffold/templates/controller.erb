<%= mc_wrap_with_namespaces(@controller_helper.namespace) do
<<-EOS
class #{@controller_helper.class_name} < BaseController
#{@controller_helper.actions.include?(:index).present? ? "
  def index
    authorize(::#{@controller_helper.module_full_name})

    render_success(
      #{@controller_helper.resource_name_plural},
      meta: { total: #{@controller_helper.resource_name_plural}.count }
    )
  end" : ''}
#{@controller_helper.actions.include?(:create).present? ? "
  def create
    authorize(::#{@controller_helper.module_full_name})

    service = ::#{@controller_helper.services_helper.full_class_name('create')}.call(params)

    render_service(service)
  end" : ''}
#{@controller_helper.actions.include?(:show).present? ? "
  def show
    authorize(#{@controller_helper.resource_name})

    render_success(#{@controller_helper.resource_name})
  end" : ''}
#{@controller_helper.actions.include?(:update).present? ? "
  def update
    authorize(#{@controller_helper.resource_name})

    service = ::#{@controller_helper.services_helper.full_class_name('update')}.call(#{@controller_helper.resource_name}, params)

    render_service(service)
  end" : ''}
#{@controller_helper.actions.include?(:destroy).present? ? "
  def destroy
    authorize(#{@controller_helper.resource_name})

    service = ::#{@controller_helper.services_helper.full_class_name('destroy')}.call(#{@controller_helper.resource_name})

    render_service(service)
  end" : ''}
#{(@controller_helper.actions & [:show, :create, :update]).any? ? "
  private

  def #{@controller_helper.resource_name}
    @#{@controller_helper.resource_name} ||= #{@controller_helper.resource_name_plural}.find(params[:id])
  end

  def #{@controller_helper.resource_name_plural}
    @#{@controller_helper.resource_name_plural} ||= policy_scope(::#{@controller_helper.module_full_name})
  end" : ''}

end
EOS
end %>
